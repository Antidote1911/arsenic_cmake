name: Build Qt Application

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  build:
    runs-on: windows-latest

    env:
      Qt_Version: 6.8.0
      Qt_Dir: C:\Qt\${{ env.Qt_Version }}
      MinGW_Dir: C:\LLVM-MinGW

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Qt
      uses: jurplel/install-qt-action@v4
      with:
        version: ${{ env.Qt_Version }}
        host: windows
        target: desktop
        arch: win64_mingw
        dir: ${{ env.Qt_Dir }}

    - name: Install LLVM MinGW
      run: |
        choco install llvm --version=12.0.0
        choco install mingw --version=8.0.0
        echo "::add-path::C:\Program Files\LLVM\bin"
        echo "::add-path::C:\MinGW\bin"

    - name: Configure CMake
      run: |
        mkdir build
        cd build
        cmake -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=${{ env.Qt_Dir }} ..

    - name: Build
      run: |
        cd build
        cmake --build . --config Release
